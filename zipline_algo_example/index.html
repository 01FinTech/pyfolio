<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Quantopian Inc.">
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Zipline algorithm - pyfolio</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">pyfolio</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Overview</a>
                    </li>
                
                
                
                    <li >
                        <a href="../whatsnew/">Releases</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorial <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../single_stock_example/">Single stock</a>
</li>

                        
                            
<li class="active">
    <a href="./">Zipline algorithm</a>
</li>

                        
                            
<li >
    <a href="../bayesian/">Bayesian analysis</a>
</li>

                        
                            
<li >
    <a href="../sector_mapping_example/">Sector analysis</a>
</li>

                        
                            
<li >
    <a href="../round_trip_example/">Round trip analysis</a>
</li>

                        
                            
<li >
    <a href="../slippage_example/">Slippage analysis</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../single_stock_example/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../bayesian/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/quantopian/pyfolio">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#zipline-algorithm-analysis-example-in-pyfolio">Zipline algorithm analysis example in pyfolio</a></li>
        
            <li><a href="#imports">Imports</a></li>
        
            <li><a href="#run-our-zipline-algorithm">Run our zipline algorithm</a></li>
        
            <li><a href="#extract-metrics">Extract metrics</a></li>
        
            <li><a href="#single-plot-example">Single plot example</a></li>
        
            <li><a href="#full-tear-sheet-example">Full tear sheet example</a></li>
        
            <li><a href="#suppressing-symbol-output">Suppressing symbol output</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="zipline-algorithm-analysis-example-in-pyfolio">Zipline algorithm analysis example in pyfolio</h1>
<p>Here's an example where we run an algorithm with zipline, then produce tear sheets for that algorithm.</p>
<h2 id="imports">Imports</h2>
<p>Import pyfolio, along with the necessary modules for running our zipline backtest.</p>
<pre><code class="python">%matplotlib inline
import pyfolio as pf
</code></pre>

<pre><code class="python">import sys
import logbook
import numpy as np
from datetime import datetime
import pytz

from zipline.algorithm import TradingAlgorithm
from zipline.utils.factory import load_from_yahoo
from zipline.finance import commission
</code></pre>

<h2 id="run-our-zipline-algorithm">Run our zipline algorithm</h2>
<p>This algorithm can also be adjusted to execute a modified, or completely different, trading strategy.</p>
<pre><code class="python"># Zipline trading algorithm
# Taken from zipline.examples.olmar
zipline_logging = logbook.NestedSetup([
    logbook.NullHandler(level=logbook.DEBUG),
    logbook.StreamHandler(sys.stdout, level=logbook.INFO),
    logbook.StreamHandler(sys.stderr, level=logbook.ERROR),
])
zipline_logging.push_application()

STOCKS = ['AMD', 'CERN', 'COST', 'DELL', 'GPS', 'INTC', 'MMM']


# On-Line Portfolio Moving Average Reversion

# More info can be found in the corresponding paper:
# http://icml.cc/2012/papers/168.pdf
def initialize(algo, eps=1, window_length=5):
    algo.stocks = STOCKS
    algo.sids = [algo.symbol(symbol) for symbol in algo.stocks]
    algo.m = len(algo.stocks)
    algo.price = {}
    algo.b_t = np.ones(algo.m) / algo.m
    algo.last_desired_port = np.ones(algo.m) / algo.m
    algo.eps = eps
    algo.init = True
    algo.days = 0
    algo.window_length = window_length

    algo.set_commission(commission.PerShare(cost=0))


def handle_data(algo, data):
    algo.days += 1
    if algo.days &lt; algo.window_length:
        return

    if algo.init:
        rebalance_portfolio(algo, data, algo.b_t)
        algo.init = False
        return

    m = algo.m

    x_tilde = np.zeros(m)
    b = np.zeros(m)

    # find relative moving average price for each asset
    mavgs = data.history(algo.sids, 'price', algo.window_length, '1d').mean()
    for i, sid in enumerate(algo.sids):
        price = data.current(sid, &quot;price&quot;)
        # Relative mean deviation
        x_tilde[i] = mavgs[sid] / price

    ###########################
    # Inside of OLMAR (algo 2)
    x_bar = x_tilde.mean()

    # market relative deviation
    mark_rel_dev = x_tilde - x_bar

    # Expected return with current portfolio
    exp_return = np.dot(algo.b_t, x_tilde)
    weight = algo.eps - exp_return
    variability = (np.linalg.norm(mark_rel_dev)) ** 2

    # test for divide-by-zero case
    if variability == 0.0:
        step_size = 0
    else:
        step_size = max(0, weight / variability)

    b = algo.b_t + step_size * mark_rel_dev
    b_norm = simplex_projection(b)
    np.testing.assert_almost_equal(b_norm.sum(), 1)

    rebalance_portfolio(algo, data, b_norm)

    # update portfolio
    algo.b_t = b_norm


def rebalance_portfolio(algo, data, desired_port):
    # rebalance portfolio
    desired_amount = np.zeros_like(desired_port)
    current_amount = np.zeros_like(desired_port)
    prices = np.zeros_like(desired_port)

    if algo.init:
        positions_value = algo.portfolio.starting_cash
    else:
        positions_value = algo.portfolio.positions_value + \
            algo.portfolio.cash

    for i, sid in enumerate(algo.sids):
        current_amount[i] = algo.portfolio.positions[sid].amount
        prices[i] = data.current(sid, &quot;price&quot;)

    desired_amount = np.round(desired_port * positions_value / prices)

    algo.last_desired_port = desired_port
    diff_amount = desired_amount - current_amount

    for i, sid in enumerate(algo.sids):
        algo.order(sid, diff_amount[i])


def simplex_projection(v, b=1):
    &quot;&quot;&quot;Projection vectors to the simplex domain
    Implemented according to the paper: Efficient projections onto the
    l1-ball for learning in high dimensions, John Duchi, et al. ICML 2008.
    Implementation Time: 2011 June 17 by Bin@libin AT pmail.ntu.edu.sg
    Optimization Problem: min_{w}\| w - v \|_{2}^{2}
    s.t. sum_{i=1}^{m}=z, w_{i}\geq 0
    Input: A vector v \in R^{m}, and a scalar z &gt; 0 (default=1)
    Output: Projection vector w
    :Example:
    &gt;&gt;&gt; proj = simplex_projection([.4 ,.3, -.4, .5])
    &gt;&gt;&gt; print(proj)
    array([ 0.33333333, 0.23333333, 0. , 0.43333333])
    &gt;&gt;&gt; print(proj.sum())
    1.0
    Original matlab implementation: John Duchi (jduchi@cs.berkeley.edu)
    Python-port: Copyright 2013 by Thomas Wiecki (thomas.wiecki@gmail.com).
    &quot;&quot;&quot;

    v = np.asarray(v)
    p = len(v)

    # Sort v into u in descending order
    v = (v &gt; 0) * v
    u = np.sort(v)[::-1]
    sv = np.cumsum(u)

    rho = np.where(u &gt; (sv - b) / np.arange(1, p + 1))[0][-1]
    theta = np.max([0, (sv[rho] - b) / (rho + 1)])
    w = (v - theta)
    w[w &lt; 0] = 0
    return w


start = datetime(2004, 1, 1, 0, 0, 0, 0, pytz.utc)
end = datetime(2010, 1, 1, 0, 0, 0, 0, pytz.utc)

# Load price data from yahoo.
data = load_from_yahoo(stocks=STOCKS, indexes={}, start=start, end=end)
data = data.dropna()

# Create and run the algorithm.
olmar = TradingAlgorithm(handle_data=handle_data, initialize=initialize)
results = olmar.run(data)
</code></pre>

<pre><code>[2016-04-21 09:37:33.915336] INFO: Loader: Loading stock: AMD
[2016-04-21 09:37:33.926626] INFO: Loader: Loading stock: CERN
[2016-04-21 09:37:33.936490] INFO: Loader: Loading stock: COST
[2016-04-21 09:37:33.951613] INFO: Loader: Loading stock: DELL
[2016-04-21 09:37:33.965023] INFO: Loader: Loading stock: GPS
[2016-04-21 09:37:33.976631] INFO: Loader: Loading stock: INTC
[2016-04-21 09:37:33.987218] INFO: Loader: Loading stock: MMM
[2016-04-21 09:37:50.955240] INFO: Performance: Simulated 1511 trading days out of 1511.
[2016-04-21 09:37:50.956092] INFO: Performance: first open: 2004-01-02 14:31:00+00:00
[2016-04-21 09:37:50.956915] INFO: Performance: last close: 2009-12-31 21:00:00+00:00
</code></pre>
<h2 id="extract-metrics">Extract metrics</h2>
<p>Get the returns, positions, and transactions from the zipline backtest object.</p>
<pre><code class="python">returns, positions, transactions, gross_lev = pf.utils.extract_rets_pos_txn_from_zipline(results)
</code></pre>

<h2 id="single-plot-example">Single plot example</h2>
<p>Make one plot of the top 5 drawdown periods.</p>
<pre><code class="python">pf.plot_drawdown_periods(returns, top=5).set_xlabel('Date')
</code></pre>

<pre><code>&lt;matplotlib.text.Text at 0x7fd6ff3d9198&gt;
</code></pre>
<p><img alt="png" src="../zipline_algo_example_files/zipline_algo_example_10_1.png" /></p>
<h2 id="full-tear-sheet-example">Full tear sheet example</h2>
<p>Create a full tear sheet for our algorithm. As an example, set the live start date to something arbitrary.</p>
<pre><code class="python">pf.create_full_tear_sheet(returns, positions=positions, transactions=transactions,
                          gross_lev=gross_lev, live_start_date='2009-10-22', round_trips=True)
</code></pre>

<pre><code>Entire data start date: 2004-01-02
Entire data end date: 2009-12-31


Out-of-Sample Months: 2
Backtest Months: 69
</code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Performance statistics</th>
      <th>All history</th>
      <th>Backtest</th>
      <th>Out of sample</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>annual_return</th>
      <td>0.08</td>
      <td>0.08</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>annual_volatility</th>
      <td>0.25</td>
      <td>0.26</td>
      <td>0.22</td>
    </tr>
    <tr>
      <th>sharpe_ratio</th>
      <td>0.44</td>
      <td>0.43</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>calmar_ratio</th>
      <td>0.14</td>
      <td>0.14</td>
      <td>0.42</td>
    </tr>
    <tr>
      <th>stability_of_timeseries</th>
      <td>-0.01</td>
      <td>-0.09</td>
      <td>0.22</td>
    </tr>
    <tr>
      <th>max_drawdown</th>
      <td>-0.60</td>
      <td>-0.60</td>
      <td>-0.07</td>
    </tr>
    <tr>
      <th>omega_ratio</th>
      <td>1.08</td>
      <td>1.08</td>
      <td>1.04</td>
    </tr>
    <tr>
      <th>sortino_ratio</th>
      <td>0.65</td>
      <td>0.64</td>
      <td>0.34</td>
    </tr>
    <tr>
      <th>skew</th>
      <td>0.27</td>
      <td>0.28</td>
      <td>-0.28</td>
    </tr>
    <tr>
      <th>kurtosis</th>
      <td>4.05</td>
      <td>4.10</td>
      <td>0.47</td>
    </tr>
    <tr>
      <th>tail_ratio</th>
      <td>0.97</td>
      <td>0.99</td>
      <td>1.24</td>
    </tr>
    <tr>
      <th>common_sense_ratio</th>
      <td>1.05</td>
      <td>1.07</td>
      <td>1.27</td>
    </tr>
    <tr>
      <th>information_ratio</th>
      <td>0.02</td>
      <td>0.02</td>
      <td>-0.05</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>0.08</td>
      <td>0.08</td>
      <td>-0.11</td>
    </tr>
    <tr>
      <th>beta</th>
      <td>0.81</td>
      <td>0.81</td>
      <td>1.18</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Worst Drawdown Periods</th>
      <th>net drawdown in %</th>
      <th>peak date</th>
      <th>valley date</th>
      <th>recovery date</th>
      <th>duration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>59.91</td>
      <td>2007-11-06</td>
      <td>2008-11-20</td>
      <td>NaT</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22.79</td>
      <td>2006-02-16</td>
      <td>2006-08-31</td>
      <td>2007-05-22</td>
      <td>329</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12.70</td>
      <td>2005-07-28</td>
      <td>2005-10-12</td>
      <td>2006-01-11</td>
      <td>120</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11.65</td>
      <td>2004-11-15</td>
      <td>2005-04-28</td>
      <td>2005-07-28</td>
      <td>184</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9.50</td>
      <td>2007-07-16</td>
      <td>2007-08-06</td>
      <td>2007-09-13</td>
      <td>44</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code>[-0.032 -0.069]
</code></pre>
<p><img alt="png" src="../zipline_algo_example_files/zipline_algo_example_12_4.png" /></p>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Stress Events</th>
      <th>mean</th>
      <th>min</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Lehmann</th>
      <td>-0.26%</td>
      <td>-4.45%</td>
      <td>4.41%</td>
    </tr>
    <tr>
      <th>Aug07</th>
      <td>0.34%</td>
      <td>-2.96%</td>
      <td>3.02%</td>
    </tr>
    <tr>
      <th>Mar08</th>
      <td>-0.44%</td>
      <td>-3.10%</td>
      <td>3.33%</td>
    </tr>
    <tr>
      <th>Sept08</th>
      <td>-0.64%</td>
      <td>-4.35%</td>
      <td>3.99%</td>
    </tr>
    <tr>
      <th>2009Q1</th>
      <td>-0.36%</td>
      <td>-4.99%</td>
      <td>3.35%</td>
    </tr>
    <tr>
      <th>2009Q2</th>
      <td>0.71%</td>
      <td>-3.78%</td>
      <td>6.15%</td>
    </tr>
    <tr>
      <th>Low Volatility Bull Market</th>
      <td>0.01%</td>
      <td>-6.13%</td>
      <td>6.40%</td>
    </tr>
    <tr>
      <th>GFC Crash</th>
      <td>-0.08%</td>
      <td>-7.59%</td>
      <td>9.70%</td>
    </tr>
    <tr>
      <th>Recovery</th>
      <td>0.32%</td>
      <td>-3.78%</td>
      <td>6.15%</td>
    </tr>
  </tbody>
</table>
</div>

<p><img alt="png" src="../zipline_algo_example_files/zipline_algo_example_12_6.png" /></p>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Top 10 long positions of all time</th>
      <th>max</th>
    </tr>
    <tr>
      <th>sid</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Equity(3 [COST])</th>
      <td>100.76%</td>
    </tr>
    <tr>
      <th>Equity(7 [MMM])</th>
      <td>92.38%</td>
    </tr>
    <tr>
      <th>Equity(2 [CERN])</th>
      <td>84.49%</td>
    </tr>
    <tr>
      <th>Equity(4 [DELL])</th>
      <td>71.71%</td>
    </tr>
    <tr>
      <th>Equity(1 [AMD])</th>
      <td>71.05%</td>
    </tr>
    <tr>
      <th>Equity(6 [INTC])</th>
      <td>66.55%</td>
    </tr>
    <tr>
      <th>Equity(5 [GPS])</th>
      <td>62.13%</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Top 10 short positions of all time</th>
      <th>max</th>
    </tr>
    <tr>
      <th>sid</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Top 10 positions of all time</th>
      <th>max</th>
    </tr>
    <tr>
      <th>sid</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Equity(3 [COST])</th>
      <td>100.76%</td>
    </tr>
    <tr>
      <th>Equity(7 [MMM])</th>
      <td>92.38%</td>
    </tr>
    <tr>
      <th>Equity(2 [CERN])</th>
      <td>84.49%</td>
    </tr>
    <tr>
      <th>Equity(4 [DELL])</th>
      <td>71.71%</td>
    </tr>
    <tr>
      <th>Equity(1 [AMD])</th>
      <td>71.05%</td>
    </tr>
    <tr>
      <th>Equity(6 [INTC])</th>
      <td>66.55%</td>
    </tr>
    <tr>
      <th>Equity(5 [GPS])</th>
      <td>62.13%</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>All positions ever held</th>
      <th>max</th>
    </tr>
    <tr>
      <th>sid</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Equity(3 [COST])</th>
      <td>100.76%</td>
    </tr>
    <tr>
      <th>Equity(7 [MMM])</th>
      <td>92.38%</td>
    </tr>
    <tr>
      <th>Equity(2 [CERN])</th>
      <td>84.49%</td>
    </tr>
    <tr>
      <th>Equity(4 [DELL])</th>
      <td>71.71%</td>
    </tr>
    <tr>
      <th>Equity(1 [AMD])</th>
      <td>71.05%</td>
    </tr>
    <tr>
      <th>Equity(6 [INTC])</th>
      <td>66.55%</td>
    </tr>
    <tr>
      <th>Equity(5 [GPS])</th>
      <td>62.13%</td>
    </tr>
  </tbody>
</table>
</div>

<p><img alt="png" src="../zipline_algo_example_files/zipline_algo_example_12_11.png" /></p>
<p><img alt="png" src="../zipline_algo_example_files/zipline_algo_example_12_12.png" /></p>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Summary stats</th>
      <th>All trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total number of round_trips</th>
      <td>3729.00</td>
      <td>3729.00</td>
    </tr>
    <tr>
      <th>Percent profitable</th>
      <td>0.43</td>
      <td>0.43</td>
    </tr>
    <tr>
      <th>Winning round_trips</th>
      <td>1616.00</td>
      <td>1616.00</td>
    </tr>
    <tr>
      <th>Losing round_trips</th>
      <td>2113.00</td>
      <td>2113.00</td>
    </tr>
    <tr>
      <th>Even round_trips</th>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>PnL stats</th>
      <th>All trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total profit</th>
      <td>$61673.54</td>
      <td>$61673.54</td>
    </tr>
    <tr>
      <th>Gross profit</th>
      <td>$376899.39</td>
      <td>$376899.39</td>
    </tr>
    <tr>
      <th>Gross loss</th>
      <td>$-315225.85</td>
      <td>$-315225.85</td>
    </tr>
    <tr>
      <th>Profit factor</th>
      <td>$1.20</td>
      <td>$1.20</td>
    </tr>
    <tr>
      <th>Avg. trade net profit</th>
      <td>$16.54</td>
      <td>$16.54</td>
    </tr>
    <tr>
      <th>Avg. winning trade</th>
      <td>$233.23</td>
      <td>$233.23</td>
    </tr>
    <tr>
      <th>Avg. losing trade</th>
      <td>$-149.18</td>
      <td>$-149.18</td>
    </tr>
    <tr>
      <th>Ratio Avg. Win:Avg. Loss</th>
      <td>$1.56</td>
      <td>$1.56</td>
    </tr>
    <tr>
      <th>Largest winning trade</th>
      <td>$15541.78</td>
      <td>$15541.78</td>
    </tr>
    <tr>
      <th>Largest losing trade</th>
      <td>$-12468.25</td>
      <td>$-12468.25</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Duration stats</th>
      <th>All trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Avg duration</th>
      <td>22 days 05:36:44.023330</td>
      <td>22 days 05:36:44.023330</td>
    </tr>
    <tr>
      <th>Median duration</th>
      <td>18 days 00:00:00</td>
      <td>18 days 00:00:00</td>
    </tr>
    <tr>
      <th>Avg # round_trips per day</th>
      <td>34.53</td>
      <td>34.53</td>
    </tr>
    <tr>
      <th>Avg # round_trips per month</th>
      <td>725.08</td>
      <td>725.08</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Return stats</th>
      <th>All trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Avg returns all round_trips</th>
      <td>0.01%</td>
      <td>0.01%</td>
    </tr>
    <tr>
      <th>Avg returns winning</th>
      <td>0.19%</td>
      <td>0.19%</td>
    </tr>
    <tr>
      <th>Avg returns losing</th>
      <td>-0.13%</td>
      <td>-0.13%</td>
    </tr>
    <tr>
      <th>Median returns all round_trips</th>
      <td>-0.00%</td>
      <td>-0.00%</td>
    </tr>
    <tr>
      <th>Median returns winning</th>
      <td>0.03%</td>
      <td>0.03%</td>
    </tr>
    <tr>
      <th>Median returns losing</th>
      <td>-0.01%</td>
      <td>-0.01%</td>
    </tr>
    <tr>
      <th>Largest winning trade</th>
      <td>12.12%</td>
      <td>12.12%</td>
    </tr>
    <tr>
      <th>Largest losing trade</th>
      <td>-9.15%</td>
      <td>-9.15%</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Symbol stats</th>
      <th>Equity(1 [AMD])</th>
      <th>Equity(2 [CERN])</th>
      <th>Equity(3 [COST])</th>
      <th>Equity(4 [DELL])</th>
      <th>Equity(5 [GPS])</th>
      <th>Equity(6 [INTC])</th>
      <th>Equity(7 [MMM])</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Avg returns all round_trips</th>
      <td>-0.00%</td>
      <td>0.03%</td>
      <td>0.03%</td>
      <td>-0.04%</td>
      <td>-0.01%</td>
      <td>0.04%</td>
      <td>0.01%</td>
    </tr>
    <tr>
      <th>Avg returns winning</th>
      <td>0.41%</td>
      <td>0.22%</td>
      <td>0.15%</td>
      <td>0.15%</td>
      <td>0.15%</td>
      <td>0.19%</td>
      <td>0.12%</td>
    </tr>
    <tr>
      <th>Avg returns losing</th>
      <td>-0.34%</td>
      <td>-0.15%</td>
      <td>-0.06%</td>
      <td>-0.18%</td>
      <td>-0.10%</td>
      <td>-0.07%</td>
      <td>-0.08%</td>
    </tr>
    <tr>
      <th>Median returns all round_trips</th>
      <td>-0.00%</td>
      <td>-0.00%</td>
      <td>-0.00%</td>
      <td>-0.00%</td>
      <td>-0.00%</td>
      <td>-0.00%</td>
      <td>-0.00%</td>
    </tr>
    <tr>
      <th>Median returns winning</th>
      <td>0.10%</td>
      <td>0.03%</td>
      <td>0.03%</td>
      <td>0.02%</td>
      <td>0.04%</td>
      <td>0.06%</td>
      <td>0.02%</td>
    </tr>
    <tr>
      <th>Median returns losing</th>
      <td>-0.02%</td>
      <td>-0.01%</td>
      <td>-0.01%</td>
      <td>-0.01%</td>
      <td>-0.01%</td>
      <td>-0.00%</td>
      <td>-0.01%</td>
    </tr>
    <tr>
      <th>Largest winning trade</th>
      <td>12.12%</td>
      <td>5.91%</td>
      <td>2.95%</td>
      <td>2.48%</td>
      <td>3.52%</td>
      <td>2.32%</td>
      <td>2.23%</td>
    </tr>
    <tr>
      <th>Largest losing trade</th>
      <td>-9.15%</td>
      <td>-4.68%</td>
      <td>-3.41%</td>
      <td>-5.87%</td>
      <td>-8.27%</td>
      <td>-4.61%</td>
      <td>-3.84%</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Profitability (PnL / PnL total) per name</th>
      <th>pnl</th>
    </tr>
    <tr>
      <th>symbol</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Equity(6 [INTC])</th>
      <td>0.44%</td>
    </tr>
    <tr>
      <th>Equity(3 [COST])</th>
      <td>0.40%</td>
    </tr>
    <tr>
      <th>Equity(2 [CERN])</th>
      <td>0.34%</td>
    </tr>
    <tr>
      <th>Equity(7 [MMM])</th>
      <td>0.18%</td>
    </tr>
    <tr>
      <th>Equity(5 [GPS])</th>
      <td>0.02%</td>
    </tr>
    <tr>
      <th>Equity(1 [AMD])</th>
      <td>-0.06%</td>
    </tr>
    <tr>
      <th>Equity(4 [DELL])</th>
      <td>-0.32%</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code>&lt;matplotlib.figure.Figure at 0x7fd6f7c5a6a0&gt;
</code></pre>
<p><img alt="png" src="../zipline_algo_example_files/zipline_algo_example_12_20.png" /></p>
<h2 id="suppressing-symbol-output">Suppressing symbol output</h2>
<p>When sharing tear sheets it might be undesirable to display which symbols where used by a strategy. To suppress these in the tear sheet you can pass <code>hide_positions=True</code>.</p>
<pre><code class="python">pf.create_full_tear_sheet(returns, positions=positions, transactions=transactions,
                          gross_lev=gross_lev, live_start_date='2009-10-22',
                          hide_positions=True)
</code></pre>

<pre><code>Entire data start date: 2004-01-02
Entire data end date: 2009-12-31


Out-of-Sample Months: 2
Backtest Months: 69
</code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Performance statistics</th>
      <th>All history</th>
      <th>Backtest</th>
      <th>Out of sample</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>annual_return</th>
      <td>0.08</td>
      <td>0.08</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>annual_volatility</th>
      <td>0.25</td>
      <td>0.26</td>
      <td>0.22</td>
    </tr>
    <tr>
      <th>sharpe_ratio</th>
      <td>0.44</td>
      <td>0.43</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>calmar_ratio</th>
      <td>0.14</td>
      <td>0.14</td>
      <td>0.42</td>
    </tr>
    <tr>
      <th>stability_of_timeseries</th>
      <td>-0.01</td>
      <td>-0.09</td>
      <td>0.22</td>
    </tr>
    <tr>
      <th>max_drawdown</th>
      <td>-0.60</td>
      <td>-0.60</td>
      <td>-0.07</td>
    </tr>
    <tr>
      <th>omega_ratio</th>
      <td>1.08</td>
      <td>1.08</td>
      <td>1.04</td>
    </tr>
    <tr>
      <th>sortino_ratio</th>
      <td>0.65</td>
      <td>0.64</td>
      <td>0.34</td>
    </tr>
    <tr>
      <th>skew</th>
      <td>0.27</td>
      <td>0.28</td>
      <td>-0.28</td>
    </tr>
    <tr>
      <th>kurtosis</th>
      <td>4.05</td>
      <td>4.10</td>
      <td>0.47</td>
    </tr>
    <tr>
      <th>tail_ratio</th>
      <td>0.97</td>
      <td>0.99</td>
      <td>1.24</td>
    </tr>
    <tr>
      <th>common_sense_ratio</th>
      <td>1.05</td>
      <td>1.07</td>
      <td>1.27</td>
    </tr>
    <tr>
      <th>information_ratio</th>
      <td>0.02</td>
      <td>0.02</td>
      <td>-0.05</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>0.08</td>
      <td>0.08</td>
      <td>-0.11</td>
    </tr>
    <tr>
      <th>beta</th>
      <td>0.81</td>
      <td>0.81</td>
      <td>1.18</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Worst Drawdown Periods</th>
      <th>net drawdown in %</th>
      <th>peak date</th>
      <th>valley date</th>
      <th>recovery date</th>
      <th>duration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>59.91</td>
      <td>2007-11-06</td>
      <td>2008-11-20</td>
      <td>NaT</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22.79</td>
      <td>2006-02-16</td>
      <td>2006-08-31</td>
      <td>2007-05-22</td>
      <td>329</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12.70</td>
      <td>2005-07-28</td>
      <td>2005-10-12</td>
      <td>2006-01-11</td>
      <td>120</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11.65</td>
      <td>2004-11-15</td>
      <td>2005-04-28</td>
      <td>2005-07-28</td>
      <td>184</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9.50</td>
      <td>2007-07-16</td>
      <td>2007-08-06</td>
      <td>2007-09-13</td>
      <td>44</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code>[-0.032 -0.069]
</code></pre>
<p><img alt="png" src="../zipline_algo_example_files/zipline_algo_example_14_4.png" /></p>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Stress Events</th>
      <th>mean</th>
      <th>min</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Lehmann</th>
      <td>-0.26%</td>
      <td>-4.45%</td>
      <td>4.41%</td>
    </tr>
    <tr>
      <th>Aug07</th>
      <td>0.34%</td>
      <td>-2.96%</td>
      <td>3.02%</td>
    </tr>
    <tr>
      <th>Mar08</th>
      <td>-0.44%</td>
      <td>-3.10%</td>
      <td>3.33%</td>
    </tr>
    <tr>
      <th>Sept08</th>
      <td>-0.64%</td>
      <td>-4.35%</td>
      <td>3.99%</td>
    </tr>
    <tr>
      <th>2009Q1</th>
      <td>-0.36%</td>
      <td>-4.99%</td>
      <td>3.35%</td>
    </tr>
    <tr>
      <th>2009Q2</th>
      <td>0.71%</td>
      <td>-3.78%</td>
      <td>6.15%</td>
    </tr>
    <tr>
      <th>Low Volatility Bull Market</th>
      <td>0.01%</td>
      <td>-6.13%</td>
      <td>6.40%</td>
    </tr>
    <tr>
      <th>GFC Crash</th>
      <td>-0.08%</td>
      <td>-7.59%</td>
      <td>9.70%</td>
    </tr>
    <tr>
      <th>Recovery</th>
      <td>0.32%</td>
      <td>-3.78%</td>
      <td>6.15%</td>
    </tr>
  </tbody>
</table>
</div>

<p><img alt="png" src="../zipline_algo_example_files/zipline_algo_example_14_6.png" /></p>
<p><img alt="png" src="../zipline_algo_example_files/zipline_algo_example_14_7.png" /></p>
<p><img alt="png" src="../zipline_algo_example_files/zipline_algo_example_14_8.png" /></p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
